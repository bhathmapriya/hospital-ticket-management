<!DOCTYPE html>
<html>

<head>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.4.0/font/bootstrap-icons.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css"
    integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">

  <style>
    select {
      display: block;
    }

    .navbar a {
      color: white !important;
    }

    .doctor-list-container {
      display: flex;
      margin-top: 20px;
    }

    .doc-card {
      margin-right: 20px;
      padding: 20px;
      box-shadow: 1px 1px 7px 0px #00000038;
    }

    .doc-card label {
      font-size: 14px;
    }
  </style>
</head>

<body>
  <nav class="navbar navbar-default navbar-expand-lg navbar-light bg-light" style="position: sticky;
    top: 0px; min-height: 100px;
    z-index: 1; background: linear-gradient(to right,#80d4ff,#00a3cc,#006680);">
    <div class="container-fluid">
      <div class="navbar-header">
        <b><a class="navbar-brand" href="/">Hospital Ticket Manager </a></b>
        <a class="navbar-brand" href="/ticketgen/<%=_id %>"><span class="glyphicon glyphicon-chevron-left"
            aria-hidden="true"></span></a>

      </div>

    </div>
  </nav>
  <link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
  <link rel="stylesheet" href="/resources/demos/style.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.22.2/moment.min.js"></script>
  <script src="https://code.jquery.com/jquery-1.12.4.js"></script>
  <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
  <script>
    $(function () {
      $("#datepicker").datepicker();
    });
    function bookappointment(doctor,patient){
      fetch('/bookappointment'{
        method:'POST', body
      })
    }
    function searchDoctors() {
      const formElements = document.getElementById('form').elements
      const params = `department=${formElements.namedItem('department').value}&date=${formElements.namedItem('date').value}&time=${formElements.namedItem('time').value}`
      fetch('/searchDoctors?' + params, {
        method: 'GET',
      }).then((data) => {
        return data.json();
      }).then(data => {
        const doctorListElement = document.getElementById('doctor-list');
        if (data.length > 0) {
          var newElement = document.createElement('div');
          newElement.classList.add('doctor-list-container');
          newElement.innerHTML = data.map(doctor => {
            let htmlValue = `<div class='doc-card'>
              <div><label>Name: </label> ${doctor.name}</div>
              <div><label>Department: </label> ${doctor.department}</div>
              <div><label>Experience: </label> ${doctor.experience}</div>
              <div><label>Email: </label> ${doctor.email}</div>
              <button class="btn btn-default btn-md btn-primary" onclick="bookappointment(${doctor._id},${_id})">Book Appointment</button>
              </div>`;
            return htmlValue;
          }).join('');
          doctorListElement.appendChild(newElement);
        } else {
          var newElement = document.createElement('div');
          newElement.innerHTML = "Doctor isn't avaiable for your search criteria !";
          doctorListElement.appendChild(newElement);
        }
      })
    }
  </script>
  <div class="container">
    <div style="width:100%; margin: 0 auto;">
      <div id="box" style="padding: 10px 25px;
      box-shadow: 2px 2px 9px #0000002e;">
        <h3 style="text-align: center; margin-top:0px; margin-bottom: 25px;">Raise a ticket</h3>

        <form id="form" style="display: flex;
          align-items: center;
          justify-content: space-evenly;">
          <div class="form-group">
            <p>Symptoms</p>
            <input type="text" name="symptoms" placeholder="Enter symptoms" required />
          </div>
          <div class="form-group">
            <p>Department</p>
            <div class="input-field col s12">
              <select name="department">
                <option value="" disabled selected>Choose department</option>
                <option value="ent">ENT</option>
                <option value="cardiology">Cardiology</option>
                <option value="Nuerology">Nuerology</option>
                <option value="Gynecology">Gynecology</option>
                <option value="Dental">Dental</option>
              </select>
            </div>
          </div>
          <br>

          <div class="form-group">
            <p>Date: <input type="date" id="datepicker" name="date" required></p>
          </div>
          <div class="form-group">
            <p>Time:<input type="time" id="appt" name="time" step="2" required /></p>
          </div>
          <div class="form-group">

            <button type="button" onclick="searchDoctors()" class="btn btn-lg btn-primary btn-block">Search</button>

          </div>
      </div>

    </div>
    </form>
    <div id="doctor-list">

    </div>
  </div>
  <%- include('partials/footer') %>